
TE CREATION

1) Create a Zigbee Gateway template
2) Create a Zigbee sensor node template (based on the sensors used), as per the Ayla docs

https://docs.aylanetworks.com/edge-solutions/ayla-linux-gateway-solution/v1-7/#zigbee-gateway

SETTING UP THUNDERBOARD

1) Flash Thunderboard sense 2 with Zigbee NCP firmware using Simplicity Studio 4
	a. Tutorial:https://www.dropbox.com/s/ko2amso0edfgxfh/Silabs%20Thunderboard%20Sense%202%20as%20Zigbee%20NCP.mov?dl=0
	b. Make  sure to validate the last step in the video that sets up vcom
	c. or use the firmware in ayla/firmware/Ayla_NCP_TBS2.s37  (git@gitolite.chennai.ap.thmulti.com:/pub/ismailn/ayla.git -b Homeware) 
2) Connect Thunderboard sense 2 to Homeware
a.	Make sure you have necessary drivers like cdc-acm installed
b.	Use dmesg to verify device connected and port info
i.	Should map to ttyACM0
3) Create directory for Zigbee files 
1.	Clone (git@gitolite.chennai.ap.thmulti.com:/pub/ismailn/ayla.git -b Homeware)
2.	cd  ayla/v2.7/app/builder/ember
3.	Change the owa_lib.mak file corresponding to the board toolchain and the sdk path 
a.	STAGING_DIR to be changed
b.	if its aarch64 change corresponding toolchain
4.	make INCLUDE_MAKEFILE=owa_lib.mak
5.	cd  ayla/v2.7/app/builder/ember/build/exe
i.	ember.a file will be generated
ii.	cp ember.a to libember.a

4)Compile ayla agent – (devd , appd ) in eth mode
a.	Cd ayla/
b.	Touch devd.conf
c.	Change ayla_install.sh corresponding to your folder name (ayla_src_dir, AylaRoot, ayla_config_dir, ayla_install_dir)
i.	Change ember path as well “/home/rajandi/ayla_owa/v2.7” in line 720
d.	Change ayla/ device_linux_gw_public/make /common_defs.mk w.r.t to your toolchain path (STAGING_DIR, TOOLCHAIN_DIR, TOOL_ROOT, TARGET_CFLAGS, TARGET_LDFLAGS)
	In device_linux_gw_public/app/zb_gatewayd/Makefile, do change EMBER_STACK_DIR/ EMBER_LIB_DIR/ EMBER_LIB_NAME 
EG:
EMBER_STACK_DIR = /home/rajandi/ayla_owa/v2.7
EMBER_PROJECT_NAME = ember
#EMBER_LIB_DIR = $(EMBER_STACK_DIR)/app/builder/$(EMBER_PROJECT_NAME)/build/exe
EMBER_LIB_DIR = /home/rajandi/ayla_owa/v2.7/app/builder/ember/build/exe
#EMBER_LIB_NAME = em3588stack6.7.6
EMBER_LIB_NAME = ember
CALLBACK_STUB_UPDATED= $(OBJ_DIR)/callback-stub-updated

e.	In the file device_linux_gw_public/app/zb_gatewayd/appd_interface.c
the device_id of the appropriate sensor needs to be updated (can be found in the logs, once the node is detected)

#define ZB_DEVICE_ID_LIGHT                      0x0100
#define ZB_DEVICE_ID_DIMM_LIGHT         0x0101
#define ZB_DEVICE_ID_SMART_PLUG         0x0009
#define ZB_DEVICE_ID_YIFANG_CONTROLLER  0x0103
#define ZB_DEVICE_ID_IRIS_CONTROLLER            0x0006
#define ZB_DEVICE_ID_IAS_ZONE                   0x0402
#define ZB_DEVICE_ID_THERMOSTAT         0x0301

f.	./ayla_install.sh -n -u -a zb_gatewayd
g.	All necessary bin config will be in ayla_target folder
5)Loading to Homeware board
a.	Scp ayla_target to /root of board
b.	Copy your ACXXX.conf  to ayla_targe/config/devd.conf

6) Start the daemons
pi@raspberrypi:~/ayla/bin $ sudo ./devd -df -t -c ../config/ &

7) Some EZSP messages will occur if everything is working

DASHBOARD INSTRUCTIONS

1) The corresponding device should be online, and the property zb_network_up should be 1.
If 0 then there is an error with your Zigbee driver.

2) Change Current value for zb_join_enable to 254.  0=disbable, 255=on, 1-254 in seconds for on duration.
You will now see that zb_join_status changes to 1.

3) Place zigbee sensor in to pairing mode. Once discovered, num_nodes increase.

4) Click on Candidates and register the device. The sensor device will be online.

5) Click on the sensor device, and you should be able to control the sensor from the dashboard now (as well as from the AURA app).



